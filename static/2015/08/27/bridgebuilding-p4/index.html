<!DOCTYPE html>
<html lang="en-GB">

<head>
	<meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="pingback" href="https://samnicholls.net/xmlrpc.php">

	
	<title>The Tolls of Bridge Building: Part IV, Mysterious Malformations &#8211; Samposium</title>
<meta name='robots' content='max-image-preview:large' />
<link rel='dns-prefetch' href='//s0.wp.com' />
<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Samposium &raquo; Feed" href="https://samnicholls.net/feed/" />
<link rel="alternate" type="application/rss+xml" title="Samposium &raquo; Comments Feed" href="https://samnicholls.net/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Samposium &raquo; The Tolls of Bridge Building: Part IV, Mysterious Malformations Comments Feed" href="https://samnicholls.net/2015/08/27/bridgebuilding-p4/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/samnicholls.net\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.7.5"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([55357,56424,8205,55356,57212],[55357,56424,8203,55356,57212])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='crayon-css'  href='https://samnicholls.net/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-github-css'  href='https://samnicholls.net/wp-content/plugins/crayon-syntax-highlighter/themes/github/github.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://samnicholls.net/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='https://samnicholls.net/wp-includes/css/dist/block-library/style.min.css?ver=5.7.5' type='text/css' media='all' />
<link rel='stylesheet' id='css-style-css'  href='https://samnicholls.net/wp-content/themes/responsive-deluxe/css/style.css?ver=5.7.5' type='text/css' media='all' />
<link rel='stylesheet' id='child-style-css'  href='https://samnicholls.net/wp-content/themes/responsive-deluxe-child/style.css?ver=5.7.5' type='text/css' media='all' />
<link rel='stylesheet' id='lato-css'  href='//fonts.googleapis.com/css?family=Lato%3A400%2C700%2C400italic&#038;ver=5.7.5' type='text/css' media='all' />
<link rel='stylesheet' id='slabo-css'  href='//fonts.googleapis.com/css?family=Slabo+27px&#038;ver=5.7.5' type='text/css' media='all' />
<link rel='stylesheet' id='fa-css'  href='https://samnicholls.net/wp-content/themes/responsive-deluxe/css/font-awesome.css?ver=5.7.5' type='text/css' media='all' />
<link rel='stylesheet' id='rd-style-css'  href='https://samnicholls.net/wp-content/themes/responsive-deluxe-child/style.css?ver=5.7.5' type='text/css' media='all' />
<link rel='stylesheet' id='css-custom-css'  href='https://samnicholls.net/wp-content/themes/responsive-deluxe/css/custom.css?ver=5.7.5' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack_css-css'  href='https://samnicholls.net/wp-content/plugins/jetpack/css/jetpack.css?ver=4.9' type='text/css' media='all' />
<script type='text/javascript' src='https://samnicholls.net/wp-includes/js/jquery/jquery.min.js?ver=3.5.1' id='jquery-core-js'></script>
<script type='text/javascript' src='https://samnicholls.net/wp-includes/js/jquery/jquery-migrate.min.js?ver=3.3.2' id='jquery-migrate-js'></script>
<script type='text/javascript' id='crayon_js-js-extra'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/samnicholls.net\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://samnicholls.net/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta' id='crayon_js-js'></script>
<script type='text/javascript' src='https://samnicholls.net/wp-content/plugins/fd-footnotes/fdfootnotes.js?ver=1.34' id='fdfootnote_script-js'></script>
<script type='text/javascript' src='https://samnicholls.net/wp-content/themes/responsive-deluxe/js/bootstrap.js?ver=5.7.5' id='bootstrap-js'></script>
<script type='text/javascript' src='https://samnicholls.net/wp-content/themes/responsive-deluxe/js/custom.js?ver=5.7.5' id='js-custom-js'></script>
<link rel="https://api.w.org/" href="https://samnicholls.net/wp-json/" /><link rel="alternate" type="application/json" href="https://samnicholls.net/wp-json/wp/v2/posts/148" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://samnicholls.net/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://samnicholls.net/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.7.5" />
<link rel="canonical" href="https://samnicholls.net/2015/08/27/bridgebuilding-p4/" />
<link rel='shortlink' href='https://wp.me/p6RfP0-2o' />
<link rel="alternate" type="application/json+oembed" href="https://samnicholls.net/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fsamnicholls.net%2F2015%2F08%2F27%2Fbridgebuilding-p4%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://samnicholls.net/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fsamnicholls.net%2F2015%2F08%2F27%2Fbridgebuilding-p4%2F&#038;format=xml" />
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-62206786-1', 'auto');
  ga('send', 'pageview');

</script>


<link rel='dns-prefetch' href='//v0.wordpress.com'>
<style type='text/css'>img#wpstats{display:none}</style>
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="The Tolls of Bridge Building: Part IV, Mysterious Malformations" />
<meta property="og:url" content="https://samnicholls.net/2015/08/27/bridgebuilding-p4/" />
<meta property="og:description" content="Following a short hiatus on the sample un-improvement job which may or may not have been halted by vr-pipe inadvertently knocking over a storage node at the Sanger Institute, our 837 non-33 jobs bu…" />
<meta property="article:published_time" content="2015-08-27T11:00:38+00:00" />
<meta property="article:modified_time" content="2016-01-18T12:03:28+00:00" />
<meta property="og:site_name" content="Samposium" />
<meta property="og:image" content="https://s0.wp.com/i/blank.jpg" />
<meta property="og:locale" content="en_GB" />
<meta name="twitter:card" content="summary" />
</head>

<body class="post-template-default single single-post postid-148 single-format-standard">


        
<header id="main-header">
    <nav class="navbar-default navbar-static-top navbar" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#rd-collapse">
                    <span class="fa fa-bars"></span>
                    <span class="sr-only screen-reader-text">Toggle navigation</span>
                </button>
                <a class="navbar-brand" href=" https://samnicholls.net/">Samposium</a>            </div>
            
            <div id="rd-collapse" class="collapse navbar-collapse">
            
            <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body class="post-template-default single single-post postid-148 single-format-standard">

<div id="main-menu" class="navbar-nav nav"><ul>
<li class="page_item page-item-8"><a href="https://samnicholls.net/about/">About Me</a></li>
<li class="page_item page-item-11"><a href="https://samnicholls.net/talks/">Talks</a></li>
<li class="page_item page-item-15"><a href="https://samnicholls.net/things-i-have-learned/">Things I Have Learned</a></li>
</ul></div></body></html>
        </div>

        </div>
    </nav>
</header>

<div class="container">

    <div class="row"><!-- Content -->
<section class="col-md-8 content-container">
                          <article class="card post hentry post-148 type-post status-publish format-standard category-sanger-qc tag-bridgebuilder tag-malformedreadfilter tag-pipeline tag-quality-control tag-sanger" id="post-148">
                <header class="entry-header">
                        <h1 class="entry-title">The Tolls of Bridge Building: Part IV, Mysterious Malformations</h1>                </header><!-- .entry-header -->

                <div class="meta-well">
                    <span style="margin-right:15px;" class=""><span class="fa fa-user"></span>&nbsp;&nbsp;&nbsp;<span class="author vcard"><a class="url fn n" href="https://samnicholls.net/about/">Sam Nicholls</a></span></span>

                    <span style="margin-right:15px;" class="entry-date published updated post-date"><span class="fa fa-clock-o"></span>&nbsp;&nbsp; <time class="entry-date published" datetime="2015-08-27T12:00:38+01:00">27th August 2015</time><time class="updated" datetime="2016-01-18T12:03:28+00:00">18th January 2016</time></span>                    <span style="margin-right:15px;" class=""><span class="fa fa-comments-o"></span>&nbsp;&nbsp; <a href="https://samnicholls.net/2015/08/27/bridgebuilding-p4/#comments"><span class="dsq-postid" data-dsqidentifier="148 http://blog.ironowl.io/?p=148">3 Comments</span></a></span>
                    <span class=""><span class="fa fa-folder-open"></span>&nbsp;&nbsp;&nbsp;<a href="https://samnicholls.net/category/bioinf/sanger-qc/" rel="category tag">Sanger-QC</a></span>
                </div>

                <div class="entry-content"><p>Following a short hiatus on the sample <em>un</em>-improvement job which may or may not have been halted by <code>vr-pipe</code> inadvertently <a href="/2015/07/31/bridgebuilding-p3/">knocking over a storage node</a> at the Sanger Institute, our <strong>837</strong> <em>non-33</em> jobs burst back in to life only to fall at the final hurdle of the first pipeline of the <code>vr-pipe</code> workflow. Despite my lack of deerstalker and pipe, it was time to play bioinformatics Sherlock Holmes.</p>
<p>Without <code>mercury</code> access to review reams of logs myself, the <code>vr-pipe</code> web interface provides a single sample of output from a random job in the state of interest. Taking its offering, it seemed I was about to get extremely familiar with lanelet <code>7293_3#8</code>. The error was at least straightforward&#8230;</p>
<h3>Accounting Irregularities<sup id="fnref-148-1"><a href="#fn-148-1" rel="footnote">1</a></sup></h3>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-64f105f4e3d66427165993" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
... [step] failed because 48619252 reads were generated in the output bam
file, yet there were 48904972 reads in the original bam file at [...]
/VRPipe/Steps/bam_realignment_around_known_indels.pm line 167
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-64f105f4e3d66427165993-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-64f105f4e3d66427165993-2">2</div><div class="crayon-num" data-line="crayon-64f105f4e3d66427165993-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-64f105f4e3d66427165993-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-64f105f4e3d66427165993-1"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">step</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-e">failed </span><span class="crayon-i">because</span><span class="crayon-h"> </span><span class="crayon-cn">48619252</span><span class="crayon-h"> </span><span class="crayon-e">reads </span><span class="crayon-e">were </span><span class="crayon-e">generated </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">the </span><span class="crayon-e">output </span><span class="crayon-e">bam</span></div><div class="crayon-line crayon-striped-line" id="crayon-64f105f4e3d66427165993-2"><span class="crayon-v">file</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">yet </span><span class="crayon-e">there </span><span class="crayon-i">were</span><span class="crayon-h"> </span><span class="crayon-cn">48904972</span><span class="crayon-h"> </span><span class="crayon-e">reads </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">the </span><span class="crayon-e">original </span><span class="crayon-e">bam </span><span class="crayon-e">file </span><span class="crayon-i">at</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-64f105f4e3d66427165993-3"><span class="crayon-o">/</span><span class="crayon-v">VRPipe</span><span class="crayon-o">/</span><span class="crayon-v">Steps</span><span class="crayon-o">/</span><span class="crayon-v">bam_realignment_around_known_indels</span><span class="crayon-sy">.</span><span class="crayon-e">pm </span><span class="crayon-i">line</span><span class="crayon-h"> </span><span class="crayon-cn">167</span></div><div class="crayon-line crayon-striped-line" id="crayon-64f105f4e3d66427165993-4">&nbsp;</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p></p>
<p>The first thing to note is that the error is raised in <code>vr-pipe</code> itself, not in the software used to perform the step in question &#8212; which happened to be <code>GATK</code>, for those interested. <code>vr-pipe</code> is open source software, <a href="https://github.com/VertebrateResequencing/vr-pipe">hosted on Github</a>. The deployed release of <code>vr-pipe</code> used by the team <a href="https://github.com/wtsi-hgi/vr-pipe">is a fork</a> and so the <a href="https://github.com/wtsi-hgi/vr-pipe/blob/hgi-release/modules/VRPipe/Steps/bam_realignment_around_known_indels.pm#L166">source raising the error</a> is available to anyone with the stomach to read Perl:</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-64f105f4e3d6d441006732" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
my $expected_reads = $in_file-&gt;metadata-&gt;{reads} || $in_file-&gt;num_records;
my $actual_reads = $out_file-&gt;num_records;

if ($actual_reads == $expected_reads) {
    return 1;
}
else {
    $out_file-&gt;unlink;
    $self-&gt;throw("cmd [$cmd_line] failed because $actual_reads reads were generated in the output bam file, yet there were $expected_reads reads in the original bam file");
}
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-64f105f4e3d6d441006732-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-64f105f4e3d6d441006732-2">2</div><div class="crayon-num" data-line="crayon-64f105f4e3d6d441006732-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-64f105f4e3d6d441006732-4">4</div><div class="crayon-num" data-line="crayon-64f105f4e3d6d441006732-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-64f105f4e3d6d441006732-6">6</div><div class="crayon-num" data-line="crayon-64f105f4e3d6d441006732-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-64f105f4e3d6d441006732-8">8</div><div class="crayon-num" data-line="crayon-64f105f4e3d6d441006732-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-64f105f4e3d6d441006732-10">10</div><div class="crayon-num" data-line="crayon-64f105f4e3d6d441006732-11">11</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-64f105f4e3d6d441006732-1"><span class="crayon-i">my</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">expected_reads</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-e">in_file</span><span class="crayon-o">-&gt;</span><span class="crayon-e">metadata</span><span class="crayon-o">-&gt;</span><span class="crayon-sy">{</span><span class="crayon-v">reads</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">in_file</span><span class="crayon-o">-&gt;</span><span class="crayon-v">num_records</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-64f105f4e3d6d441006732-2"><span class="crayon-i">my</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">actual_reads</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">out_file</span><span class="crayon-o">-&gt;</span><span class="crayon-v">num_records</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-64f105f4e3d6d441006732-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-64f105f4e3d6d441006732-4"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">actual_reads</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">expected_reads</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-64f105f4e3d6d441006732-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-64f105f4e3d6d441006732-6"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-64f105f4e3d6d441006732-7"><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-64f105f4e3d6d441006732-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">out_file</span><span class="crayon-o">-&gt;</span><span class="crayon-v">unlink</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-64f105f4e3d6d441006732-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-r">self</span><span class="crayon-o">-&gt;</span><span class="crayon-st">throw</span><span class="crayon-sy">(</span><span class="crayon-s">"cmd [$cmd_line] failed because $actual_reads reads were generated in the output bam file, yet there were $expected_reads reads in the original bam file"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-64f105f4e3d6d441006732-10"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-64f105f4e3d6d441006732-11">&nbsp;</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p></p>
<p>The code is simple, <code>vr-pipe</code> just enforces a check that all the reads from the input file make it through to the output file. Seems sensible. This is very much desired behaviour as we never drop reads from BAM files, there&#8217;s enough flags and scores <a href="https://samtools.github.io/hts-specs/SAMv1.pdf">in the SAM spec</a> to put reads aside for one reason or another without actually removing them. So we know that the job proper completed successfully (there was an output file sans errors from <code>GATK</code> itself). So the question now is, <em>where did those reads go?</em></p>
<p>Though before launching a full scale investiation, my first instinct was to question the error itself and check the numbers stated in the message were even correct. It was easy to confirm the original number of reads: <code>48,904,972</code> by checking both the <code>vr-pipe</code> metadata I generated to submit the bridged BAMs to <code>vr-pipe</code>. I ran <code>samtools view -c</code> on the bridged BAM again to be sure.</p>
<p>But <code>vr-pipe</code>&#8216;s standard over-reaction to job failure is nuking all the output files, so I&#8217;d need to run the step myself manually on lanelet <code>7293_3#8</code>. A few hours later, <code>samtools view -c</code> and <code>samtools stats</code> confirmed the output file really did contain <code>48,619,252</code> reads, a shortfall of <code>285,720</code>.</p>
<p>I asked Irina, one of our <code>vr-pipe</code> sorceresses with <code>mercury</code> access to dig out the whole log for our spotlight lanelet. Two stub <code>INFO</code> lines sat right at the tail of the <code>GATK</code> output shed immediate light on the situation&#8230;</p>
<h3>Expunged Entries</h3>
<blockquote><p>INFO 18:31:28,970 MicroScheduler &#8211; 285720 reads were filtered out during the traversal out of approximately 48904972 total reads (0.58%)</p>
<p>INFO 18:31:28,971 MicroScheduler &#8211; -&gt; 285720 reads (0.58% of total) failing MalformedReadFilter</p></blockquote>
<p>Every single of the <code>285,720</code> &#8220;missing&#8221; reads can be accounted for by this <code>MalformedReadFilter</code>. This definitely isn&#8217;t expected behaviour, as I said already, we have ways of marking reads as QC failed, supplementary or unmapped without just discarding them wholesale. Our pipeline is not supposed to drop data. The <a href="https://www.broadinstitute.org/gatk/gatkdocs/org_broadinstitute_gatk_engine_filters_MalformedReadFilter.php"><code>MalformedReadFilter</code> documentation</a> on the <code>GATK</code> website states:</p>
<blockquote><p>Note that the MalformedRead filter itself does not need to be specified in the command line because it is set automatically.</p></blockquote>
<p>This at least explains the &#8220;unexpected&#8221; nature of the filter, but surely <code>vr-pipe</code> encounters files with bad reads that need filtering all the time? My project can&#8217;t be the first&#8230; I figured I must have missed a pre-processing step, I asked around: &#8220;Was I supposed to do my own filtering?&#8221;. I compared the <code>@PG</code> lines documenting programs applied to <em>the 33</em> to see whether they had undergone different treatment, but I couldn&#8217;t see anything related to filtering, quality or otherwise.</p>
<p>I escalated the problem to Martin who replied with a spy codephrase:</p>
<blockquote><p>the MalformedReadFilter is a red herring</p></blockquote>
<p>Both Martin and Irina had seen <em>similar</em> errors that were usually indicative of the wrong version of <code>vr-pipe</code> [and|or] <code>samtools</code> &#8212; causing a subset of flagged reads to be counted rather than all. But I explained the versions were correct and I&#8217;d manually confirmed the reads as actually missing by running the command myself, we were all a little stumped.</p>
<p>I read the manual for the filter once more and realised we&#8217;d ignored the gravity of the word &#8220;malformed&#8221;:</p>
<blockquote><p>This filter is applied automatically by all GATK tools in order to protect them from crashing on reads that are grossly malformed.</p></blockquote>
<p>We&#8217;re not taking about bad quality reads, we&#8217;re talking about reads that are incorrect in such a way that it may cause an analysis to terminate early. My heart sank, I had a hunch. I ran the output from lanelet <code>7293_3#8</code>&#8216;s <code>bridgebuilder</code> adventure through <a href="https://www.broadinstitute.org/gatk/gatkdocs/org_broadinstitute_gatk_tools_walkers_readutils_PrintReads.php"><code>GATK PrintReads</code></a>, an arbitrary tool that I knew also applied the <code>MalformedReadFilter</code>. Those very same <code>INFO</code> lines were printed.</p>
<p>My hunch was right, the reads had been malformed all along.</p>
<h3>Botched Bugfix</h3>
<p>I had a pretty good idea as to what had happened but I ran the inputs to <code>brunel</code> (the final step of <code>bridgebuilder</code>) through <code>PrintReads</code> as a sanity check. This proved a little more difficult to orchestrate than one might have expected, I had to falsify headers and add those pesky missing <code>RG</code> tags that plagued us before.</p>
<p>The inputs were fine, as suspected, <code>brunel</code> was the malformer. My hunch? My <a href="https://github.com/SamStudio8/bridgebuilder/commit/e5a83b46d64f888c6dc7780779a2786d7849328e">quick hack</a> to <a href="/2015/07/31/bridgebuilding-p3/#translations">fix my last <code>brunel</code> problem</a> had come back to bite me in the ass and caused an even more subtle <code>brunel</code> problem.</p>
<p>Indeed, despite stringently checking the bridged BAMs with <a href="/2015/07/31/bridgebuilding-p3/#finalchecks">five different tools</a>, successfully generating an index and even processing the file with <code>Picard</code> to mark duplicate reads and <code>GATK</code> to detect and re-align around indels, these malformed reads <em>still</em> flew under the radar &#8212; only to be caught by a few lines of Perl that a minor patch to <code>vr-pipe</code> happened to put in the way.</p>
<p>Recall that my <code>brunel</code> fix initialises the translation array with <code>-1</code>:</p>
<blockquote><p><strong>Initialise <code>trans[i] = -1</code></strong><br />
The only quick-fix grade solution that works, causes any read on a TID that has no translation to be regarded as &#8220;unmapped&#8221;. Its TID will be set to &#8220;*&#8221; and the read is placed at the end of the result file. The output file is however, valid and indexable.</p></blockquote>
<p>This avoided an awful bug where <code>brunel</code> would assign reads to chromosome 1 if their actual chromosome did not have a translation listed in the user-input translation file. In practice, the fix worked. Reads appeared &#8220;unmapped&#8221;, their TID was an asterisk and they were listed at the end of the file. The output was viewable, indexable and usable with <code>Picard</code> and <code>GATK</code>, but <em>technically</em> <strong>not</strong> valid afterall.</p>
<p>To explain why, let&#8217;s feed everybody&#8217;s favourite bridged BAM <code>7293_3#8</code> to <a href="http://broadinstitute.github.io/picard/command-line-overview.html#ValidateSamFile"><code>Picard ValidateSamFile</code></a>, a handy tool that does what it says on the tin. <code>ValidateSamFile</code> linearly passes over each record of a BAM and prints any associated validation warnings or errors to a log file<sup id="fnref-148-2"><a href="#fn-148-2" rel="footnote">2</a></sup>. As the tool moved over the target, an occassional warning that could safely be ignored was written to my terminal<sup id="fnref-148-3"><a href="#fn-148-3" rel="footnote">3</a></sup>. The file seemed valid and as the progress bar indicated we were nearly out of chromosomes, I braced.</p>
<p>As <code>ValidateSamFile</code> attempted to validate the unmapped reads, a firehose of errors (I was expecting a lawn sprinker) spewed up the terminal and despite my best efforts I couldn&#8217;t <code>Ctrl-C</code> to point away from face.</p>
<p><a name="friends"></a></p>
<h3>False Friends</h3>
<p>There was a clear pattern to the log file. Each read that I had translated to unmapped triggered four errors. Taking just one of thousands of such quads:</p>
<blockquote><p>ERROR: [&#8230;] Mate Alignment start should be 0 because reference name = *.<br />
ERROR: [&#8230;] Mapped mate should have mate reference name<br />
ERROR: [&#8230;] Mapped read should have valid reference name<br />
ERROR: [&#8230;] Alignment start should be 0 because reference name =*.</p></blockquote>
<p>Now, a bitfield of flags on each read is just one of the methods employed by the <a href="http://samtools.github.io/hts-specs/SAMv1.pdf">BAM format</a> to perform validation and filtering operations quickly and efficiently. One of these bits: <code>0x4</code>, indicates a read is unmapped. Herein lies the problem, although I had instructed <code>brunel</code> to translate the TID (which refers to the i-th <code>@SQ</code> line in the header) to <code>-1</code> (<em>i.e.</em> no sequence), I did not set the unmapped flag. This is invalid (<code>Mapped read should have valid reference name</code>), as the read will appear as aligned, but to an unknown reference sequence.</p>
<p>Sigh. A quick hack combined with my ignorance of the underlying BAM format specification was at fault<sup id="fnref-148-4"><a href="#fn-148-4" rel="footnote">4</a></sup>.</p>
<p>The fix would be frustratingly easy, <a href="https://github.com/SamStudio8/bridgebuilder/blob/70c02c7dc8b47059605196b40840b0b4bd6a92b2/brunel/src/main.c#L299">a one-liner in <code>brunel</code> to raise the <code>UNMAPPED</code> flag</a> (and to be good, a one-liner to unset the <code>PROPER_PAIR</code> flag<sup id="fnref-148-5"><a href="#fn-148-5" rel="footnote">5</a></sup>) for the appropriate reads. Of course, expecting an easy fix jinxed the situation and the <code>MalformedReadFilter</code> cull persisted, despite my new semaphore knowledge.</p>
<p>For each offending read, <code>ValidateSamFile</code> produced a triplet of errors:</p>
<blockquote><p>ERROR: [&#8230;] Mate Alignment start should be 0 because reference name = *.<br />
ERROR: [&#8230;] MAPQ should be 0 for unmapped read.<br />
ERROR: [&#8230;] Alignment start should be 0 because reference name =*.</p></blockquote>
<p>The errors at least seem to indicate that I&#8217;d set the <code>UNMAPPED</code> flag correctly. Confusingly, the <a href="http://samtools.github.io/hts-specs/SAMv1.pdf">format spec</a> has the following point (parentheses and emphasis mine):</p>
<blockquote><p>Bit 0x4 (<strong>unmapped</strong>) is the only reliable place to tell whether the read is unmapped. If 0x4 is set, no assumptions can be made about RNAME, POS, CIGAR, MAPQ, and bits 0x2 (<strong>properly aligned</strong>), 0x100 (secondary), and 0x800 (supplemental).</p></blockquote>
<p>It would seem that canonically, the alignment start (<code>POS</code>) and mapping quality (<code>MAPQ</code>) are untrustworthy on reads where the unmapped flag is set. Yet this triplet appears exactly the same number of times as the number of reads hard filtered by the <code>MalformedReadFilter</code>.</p>
<p>I don&#8217;t understand how these reads could be regarded as &#8220;grossly malformed&#8221; if even the format specification acknowledges the possibility of these fields containing misleading information. Invalid yes, but grossly malformed? No. I just have to assume there&#8217;s a reason <code>GATK</code> is being especially anal about such reads, perhaps developers simply (and rather fairly) don&#8217;t want to deal with the scenario of not knowing what to do with reads where the values of half the fields can&#8217;t be trusted<sup id="fnref-148-6"><a href="#fn-148-6" rel="footnote">6</a></sup>. I updated <code>brunel</code> to set the alignment positions for the read and its mate alignment to position 0 in retaliation.</p>
<p>I&#8217;d reduced the <code>ValidateSamFile</code> erorr quads to triplets and now, the triplets to duos:</p>
<blockquote><p>ERROR: [&#8230;] Mate Alignment start should be 0 because reference name = *.<br />
ERROR: [&#8230;] Alignment start should be 0 because reference name =*.</p></blockquote>
<p>The alignment positions are non-zero? But I just said I&#8217;d fixed that? What gives?</p>
<p>I used <code>samtools view</code> and grabbed the tail of the BAM, those positions were indeed non-zero. I giggled at the off-by-one error, immediately knowing what I&#8217;d done wrong.</p>
<p>The BAM spec describes the alignment position field as:</p>
<blockquote><p><strong>POS</strong>: 1-based leftmost mapping POSition of the first matching base.</p></blockquote>
<p>But under the hood, the <code>pos</code> field is <a href="https://github.com/samtools/htslib/blob/f79045536b9bb89666bedf7ee665503a0d9bad2a/htslib/sam.h#L138">defined in <code>htslib</code></a> as a 0-based co-ordinate, because that&#8217;s how computers work. The 0-based indices are then converted by just adding 1 whenever necessary. Thus to obtain a value of 0, I&#8217;d need to set the positions to -1. This off-by-one mismatch is a constant source of embarrassing mistakes in bioinformatics, where typically 1-based genomic indices must be reconciled with 0-indexed data structures<sup id="fnref-148-7"><a href="#fn-148-7" rel="footnote">7</a></sup>.</p>
<p>Updating <code>brunel</code> once more, I ran the orchestrating <code>Makefile</code> to generate what I really hope to be the final set of bridged BAMs, ran them through Martin&#8217;s <code>addreplacerg</code> subcommand to fill in those missing <code>RG</code> tags and then each went up against each of the now-six final check tools (yes, they validated with <code>ValidateSamFile</code>). I checked index generation, re-ran a handful of sanity checks (mainly ensuring we hadn&#8217;t lost any reads), re-generated the manifest file before finally asking Irina for what I really hope to be the last time, to reset my <code>vr-pipe</code> setup.</p>
<p>I should add, Martin suggested that I use <code>samtools fixmate</code>, a subcommand designed for this very purpose. The problem is, for <code>fixmate</code> to know where the mates are, they must be adjacent to each-other; that is, sorted by name and not by co-ordinate. It was thus cheaper both in time and computation to just re-run <code>brunel</code> than to name-sort, <code>fixmate</code> and coord-sort and current bridged BAMs.</p>
<p><a name="victory"></a></p>
<h3>Victorious <code>vr-pipe</code> <em>Update: Hours later</em></h3>
<p>Refreshing the <code>vr-pipe</code> interface <a href="https://www.youtube.com/watch?v=8UhONY3-1os">intermittently</a>, I was waiting to see a number of inputs larger than 33 make it to the end of the first pipeline of the workflow: represented by a friendly looking green progress bar.</p>
<p>Although the number currently stands at 1, I remembered that all of <em>the 33</em> had the same leading digit and that for each progress bar, <code>vr-pipe</code> will offer up metadata on one sample job. I hopefully clicked the green progress bar and inspected the metadata, the input lanelet was not in the set of the 33 already re-mapped lanelets.</p>
<p>I&#8217;d done it. After almost a year, I&#8217;ve led my lanelet Lemmings to the end of the first level.</p>
<hr />
<h1>tl;dr</h1>
<ul>
<li><code>GATK</code> has an anal, automated and aggressive <code>MalformedReadFilter</code></li>
<li><code>Picard ValidateSamFile</code> is a useful sanity check for SAM and BAM files</li>
<li>Your cleverly simple bug fix has probably swapped a critical and obvious problem for a critically unnoticeable one</li>
<li>Software is not <strong>obliged</strong> to adhere to any or all of a format specification</li>
<li>Off by one errors continue to produce laughably simple mistakes</li>
<li>I should probably learn the BAM format spec inside out</li>
<li>Perl is still pretty grim</li>
</ul>
<div class="footnotes">
<hr />
<ol>
<li id="fn-148-1">Those reads were just resting in my account! <a href="#fnref-148-1" rev="footnote">↩</a></li>
<li id="fn-148-2">Had I known of the tool sooner, I would have employed it as part of the extensive <code>bridgebuilder</code> quality control suite. <a href="#fnref-148-2" rev="footnote">↩</a></li>
<li id="fn-148-3">Interestingly, despite <a href="/2015/07/31/bridgebuilding-p3/#vanish-rg">causing jobs to terminate</a>, a read missing an <code>RG</code> tag is a warning, not an error. <a href="#fnref-148-3" rev="footnote">↩</a></li>
<li id="fn-148-4">Which only goes to further my <em>don&#8217;t trust anyone, even yourself</em> mantra. <a href="#fnref-148-4" rev="footnote">↩</a></li>
<li id="fn-148-5">Although not strictly necessary as per the specification (see below), I figured it was cleaner. <a href="#fnref-148-5" rev="footnote">↩</a></li>
<li id="fn-148-6">Though, <a href="https://www.broadinstitute.org/gatk/gatkdocs/org_broadinstitute_gatk_engine_filters_MalformedReadFilter.php">looking at the documentation</a>, I&#8217;m not even sure <em>what</em> aspect of the read is triggering the hard filter. The three additional command line options described don&#8217;t seem to be related to any of the errors raised by <code>ValidateSamFile</code> and there is no explicit description of what is considered to be &#8220;malformed&#8221;. <a href="#fnref-148-6" rev="footnote">↩</a></li>
<li id="fn-148-7">When I originally authored <a href="https://goldilocks.readthedocs.org"><code>Goldilocks</code></a>, I tried to be clever and make things easier for myself, electing to use a 1-based index strategy throughout. This was partially inspired by FORTRAN, which features 1-indexed arrays. In the end, the strategy caused more problems than it solved and I had to carefully had to tuck my tail between my legs and <a href="https://github.com/SamStudio8/goldilocks/commit/6915d8f0347d7e71f947d84f1f381816b0d8a1e7">return to a 0-based index</a>. <a href="#fnref-148-7" rev="footnote">↩</a></li>
</ol>
</div>
</div>
                
                        <div class="tag-well"><span><span class="fa fa-tags"></span>&nbsp;&nbsp; <a href="https://samnicholls.net/tag/bridgebuilder/" rel="tag">bridgebuilder</a>,&nbsp; <a href="https://samnicholls.net/tag/malformedreadfilter/" rel="tag">malformedreadfilter</a>,&nbsp; <a href="https://samnicholls.net/tag/pipeline/" rel="tag">pipeline</a>,&nbsp; <a href="https://samnicholls.net/tag/quality-control/" rel="tag">quality control</a>,&nbsp; <a href="https://samnicholls.net/tag/sanger/" rel="tag">sanger</a></span></div>
                
                <nav class="further-reading">
	<div class="previous">
		<span>Previous Post</span>
		<a href="https://samnicholls.net/2015/08/11/first/">First</a>
	</div>
	<div class="next">
		<span>Next Post</span>
		<a href="https://samnicholls.net/2015/09/09/paths/">Paths</a>
	</div>
</nav>            </article>
                                <div class="card">

<div id="disqus_thread"></div>
                </div>
    
</section>

        <!-- Sidebar -->
        <aside class="col-md-4 sidebar-container">
		            <div id="widget-area" class="widget-area" role="complementary">
                <div id="custom_html-3" class="widget_text card widget widget_custom_html"><div class="textwidget custom-html-widget"><img src="https://pbs.twimg.com/profile_images/1044255545610436609/wt33ZbtU_400x400.jpg" height=120 style="margin-top: 20px; margin-right:10px; float: left;" alt="Sam Nicholls" />
<div style="padding-top:15px; line-height: normal"><b style="font-size: 1.2em">Sam Nicholls</b><br><span style="font-size: 0.9em;">Haplotype Wrangler at University of Birmingham.<br>I tell computers to do things, then I write about how it all went wrong.</span></div></div></div><div id="search-2" class="card widget widget_search"><form style="margin-top:15px" action="https://samnicholls.net/" id="searchform" method="get" role="form">
    <div class="form-group">
        <input type="text" class="form-control" name="s" id="s" placeholder="e.g. Search...">
    </div>
</form>
</div><div id="twitter_timeline-5" class="card widget widget_twitter_timeline"><a class="twitter-timeline" data-height="400" data-theme="light" data-link-color="#f96e5b" data-border-color="#e8e8e8" data-lang="EN" data-partner="jetpack" data-chrome="noheader nofooter noborders" href="https://twitter.com/samstudio8">My Tweets</a></div><div id="categories-5" class="card widget widget_categories"><h2>Categories</h2>
			<ul>
					<li class="cat-item cat-item-2"><a href="https://samnicholls.net/category/bioinf/">Bioinformatics</a>
<ul class='children'>
	<li class="cat-item cat-item-8"><a href="https://samnicholls.net/category/bioinf/au-phd/">AU-PhD</a>
</li>
	<li class="cat-item cat-item-3"><a href="https://samnicholls.net/category/bioinf/sanger-qc/" title="Sanger QC Project">Sanger-QC</a>
</li>
	<li class="cat-item cat-item-61"><a href="https://samnicholls.net/category/bioinf/tools/">Tools</a>
	<ul class='children'>
	<li class="cat-item cat-item-185"><a href="https://samnicholls.net/category/bioinf/tools/chitin/">chitin</a>
</li>
	</ul>
</li>
</ul>
</li>
	<li class="cat-item cat-item-80"><a href="https://samnicholls.net/category/devops/">Devops</a>
</li>
	<li class="cat-item cat-item-114"><a href="https://samnicholls.net/category/event/">Event</a>
</li>
	<li class="cat-item cat-item-21"><a href="https://samnicholls.net/category/gadgets/">Gadgets</a>
</li>
	<li class="cat-item cat-item-176"><a href="https://samnicholls.net/category/hardware/">Hardware</a>
<ul class='children'>
	<li class="cat-item cat-item-223"><a href="https://samnicholls.net/category/hardware/beehive-monitor/">Beehive Monitor</a>
</li>
	<li class="cat-item cat-item-178"><a href="https://samnicholls.net/category/hardware/esp8266/">ESP8266</a>
</li>
	<li class="cat-item cat-item-236"><a href="https://samnicholls.net/category/hardware/lego-sequencer/">Lego Sequencer</a>
</li>
	<li class="cat-item cat-item-177"><a href="https://samnicholls.net/category/hardware/lightstick/">Lightstick</a>
</li>
</ul>
</li>
	<li class="cat-item cat-item-151"><a href="https://samnicholls.net/category/lab/">Lab</a>
<ul class='children'>
	<li class="cat-item cat-item-150"><a href="https://samnicholls.net/category/lab/protocol-guides/">Protocol Guides</a>
</li>
</ul>
</li>
	<li class="cat-item cat-item-5"><a href="https://samnicholls.net/category/meta/">Meta</a>
</li>
	<li class="cat-item cat-item-62"><a href="https://samnicholls.net/category/mysteries/">Mysteries</a>
</li>
	<li class="cat-item cat-item-22"><a href="https://samnicholls.net/category/personal/">Personal</a>
</li>
	<li class="cat-item cat-item-4"><a href="https://samnicholls.net/category/photo/">Photography</a>
</li>
	<li class="cat-item cat-item-143"><a href="https://samnicholls.net/category/programming/">Programming</a>
<ul class='children'>
	<li class="cat-item cat-item-145"><a href="https://samnicholls.net/category/programming/documentation/">Documentation</a>
</li>
	<li class="cat-item cat-item-144"><a href="https://samnicholls.net/category/programming/python/">Python</a>
</li>
</ul>
</li>
	<li class="cat-item cat-item-48"><a href="https://samnicholls.net/category/status-report/">Status Report</a>
</li>
	<li class="cat-item cat-item-60"><a href="https://samnicholls.net/category/sysadm/">System Administration</a>
</li>
	<li class="cat-item cat-item-1"><a href="https://samnicholls.net/category/uncategorised/">Uncategorised</a>
</li>
			</ul>

			</div>            </div>
		        </aside>
    </div>

</div> <!-- /container -->

<footer id="main-footer" class="bg-primary">
	<div id="footer-widgets" class="container">
		    </div>
</footer>



	<div style="display:none">
	</div>
<script type='text/javascript' src='https://samnicholls.net/wp-includes/js/comment-reply.min.js?ver=5.7.5' id='comment-reply-js'></script>
<script type='text/javascript' id='disqus_count-js-extra'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"samposium-blog"};
/* ]]> */
</script>
<script type='text/javascript' src='https://samnicholls.net/wp-content/plugins/disqus-comment-system/public/js/comment_count.js?ver=3.0.17' id='disqus_count-js'></script>
<script type='text/javascript' id='disqus_embed-js-extra'>
/* <![CDATA[ */
var embedVars = {"disqusConfig":{"integration":"wordpress 3.0.17"},"disqusIdentifier":"148 http:\/\/blog.ironowl.io\/?p=148","disqusShortname":"samposium-blog","disqusTitle":"The Tolls of Bridge Building: Part IV, Mysterious Malformations","disqusUrl":"https:\/\/samnicholls.net\/2015\/08\/27\/bridgebuilding-p4\/","postId":"148"};
/* ]]> */
</script>
<script type='text/javascript' src='https://samnicholls.net/wp-content/plugins/disqus-comment-system/public/js/comment_embed.js?ver=3.0.17' id='disqus_embed-js'></script>
<script type='text/javascript' src='https://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=202335' id='devicepx-js'></script>
<script type='text/javascript' src='https://samnicholls.net/wp-content/plugins/jetpack/_inc/twitter-timeline.js?ver=4.0.0' id='jetpack-twitter-timeline-js'></script>
<script type='text/javascript' src='https://samnicholls.net/wp-includes/js/wp-embed.min.js?ver=5.7.5' id='wp-embed-js'></script>
<script type='text/javascript' src='https://stats.wp.com/e-202335.js' async defer></script>
<script type='text/javascript'>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:4.9',blog:'101350222',post:'148',tz:'1',srv:'samnicholls.net'} ]);
	_stq.push([ 'clickTrackerInit', '101350222', '148' ]);
</script>

<script type="text/javascript">
(function() {
  if (navigator.userAgent.match(/IEMobile\/10\.0/)) {
    var msViewportStyle = document.createElement("style");
    msViewportStyle.appendChild(
      document.createTextNode("@-ms-viewport{width:auto!important}")
    );
    document.getElementsByTagName("head")[0].appendChild(msViewportStyle);
  }
})();

var collapsed = false;
jQuery( document ).ready(function($) {
    $('.navbar-toggle').click(function(){
        console.log(collapsed);
        if(collapsed) {
            $('.navbar-header > button').html('<i class="fa fa-bars"></i>');
        } else {
            $('.navbar-header > button').html('<i class="fa fa-times"></i>');
        }
        $('.navbar-collapse').toggle(200);
        collapsed = !collapsed;
    });
});
</script>
	
</body>

</html>
