<!DOCTYPE html>
<html lang="en-GB">

<head>
	<meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="pingback" href="https://samnicholls.net/xmlrpc.php">

	
	<title>Raiding `rapsearch` Results &#8211; Samposium</title>
<meta name='robots' content='max-image-preview:large' />
<link rel='dns-prefetch' href='//s0.wp.com' />
<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Samposium &raquo; Feed" href="https://samnicholls.net/feed/" />
<link rel="alternate" type="application/rss+xml" title="Samposium &raquo; Comments Feed" href="https://samnicholls.net/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Samposium &raquo; Raiding `rapsearch` Results Comments Feed" href="https://samnicholls.net/2015/05/09/raiding-rapsearch-results/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/samnicholls.net\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.7.5"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([55357,56424,8205,55356,57212],[55357,56424,8203,55356,57212])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='crayon-css'  href='https://samnicholls.net/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-github-css'  href='https://samnicholls.net/wp-content/plugins/crayon-syntax-highlighter/themes/github/github.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://samnicholls.net/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='https://samnicholls.net/wp-includes/css/dist/block-library/style.min.css?ver=5.7.5' type='text/css' media='all' />
<link rel='stylesheet' id='css-style-css'  href='https://samnicholls.net/wp-content/themes/responsive-deluxe/css/style.css?ver=5.7.5' type='text/css' media='all' />
<link rel='stylesheet' id='child-style-css'  href='https://samnicholls.net/wp-content/themes/responsive-deluxe-child/style.css?ver=5.7.5' type='text/css' media='all' />
<link rel='stylesheet' id='lato-css'  href='//fonts.googleapis.com/css?family=Lato%3A400%2C700%2C400italic&#038;ver=5.7.5' type='text/css' media='all' />
<link rel='stylesheet' id='slabo-css'  href='//fonts.googleapis.com/css?family=Slabo+27px&#038;ver=5.7.5' type='text/css' media='all' />
<link rel='stylesheet' id='fa-css'  href='https://samnicholls.net/wp-content/themes/responsive-deluxe/css/font-awesome.css?ver=5.7.5' type='text/css' media='all' />
<link rel='stylesheet' id='rd-style-css'  href='https://samnicholls.net/wp-content/themes/responsive-deluxe-child/style.css?ver=5.7.5' type='text/css' media='all' />
<link rel='stylesheet' id='css-custom-css'  href='https://samnicholls.net/wp-content/themes/responsive-deluxe/css/custom.css?ver=5.7.5' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack_css-css'  href='https://samnicholls.net/wp-content/plugins/jetpack/css/jetpack.css?ver=4.9' type='text/css' media='all' />
<script type='text/javascript' src='https://samnicholls.net/wp-includes/js/jquery/jquery.min.js?ver=3.5.1' id='jquery-core-js'></script>
<script type='text/javascript' src='https://samnicholls.net/wp-includes/js/jquery/jquery-migrate.min.js?ver=3.3.2' id='jquery-migrate-js'></script>
<script type='text/javascript' id='crayon_js-js-extra'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/samnicholls.net\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://samnicholls.net/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta' id='crayon_js-js'></script>
<script type='text/javascript' src='https://samnicholls.net/wp-content/plugins/fd-footnotes/fdfootnotes.js?ver=1.34' id='fdfootnote_script-js'></script>
<script type='text/javascript' src='https://samnicholls.net/wp-content/themes/responsive-deluxe/js/bootstrap.js?ver=5.7.5' id='bootstrap-js'></script>
<script type='text/javascript' src='https://samnicholls.net/wp-content/themes/responsive-deluxe/js/custom.js?ver=5.7.5' id='js-custom-js'></script>
<link rel="https://api.w.org/" href="https://samnicholls.net/wp-json/" /><link rel="alternate" type="application/json" href="https://samnicholls.net/wp-json/wp/v2/posts/226" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://samnicholls.net/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://samnicholls.net/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.7.5" />
<link rel="canonical" href="https://samnicholls.net/2015/05/09/raiding-rapsearch-results/" />
<link rel='shortlink' href='https://wp.me/p6RfP0-3E' />
<link rel="alternate" type="application/json+oembed" href="https://samnicholls.net/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fsamnicholls.net%2F2015%2F05%2F09%2Fraiding-rapsearch-results%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://samnicholls.net/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fsamnicholls.net%2F2015%2F05%2F09%2Fraiding-rapsearch-results%2F&#038;format=xml" />
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-62206786-1', 'auto');
  ga('send', 'pageview');

</script>


<link rel='dns-prefetch' href='//v0.wordpress.com'>
<style type='text/css'>img#wpstats{display:none}</style>
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="Raiding `rapsearch` Results" />
<meta property="og:url" content="https://samnicholls.net/2015/05/09/raiding-rapsearch-results/" />
<meta property="og:description" content="Finally. After all the trouble I&#8217;ve had trying to scale BLAST, running out of disk space, database accounting irregularities and investigating an archive_exception, we have data. Thanks to th…" />
<meta property="article:published_time" content="2015-05-09T11:00:56+00:00" />
<meta property="article:modified_time" content="2016-01-18T12:30:18+00:00" />
<meta property="og:site_name" content="Samposium" />
<meta property="og:image" content="https://s0.wp.com/i/blank.jpg" />
<meta property="og:locale" content="en_GB" />
<meta name="twitter:card" content="summary" />
</head>

<body class="post-template-default single single-post postid-226 single-format-standard">


        
<header id="main-header">
    <nav class="navbar-default navbar-static-top navbar" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#rd-collapse">
                    <span class="fa fa-bars"></span>
                    <span class="sr-only screen-reader-text">Toggle navigation</span>
                </button>
                <a class="navbar-brand" href=" https://samnicholls.net/">Samposium</a>            </div>
            
            <div id="rd-collapse" class="collapse navbar-collapse">
            
            <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body class="post-template-default single single-post postid-226 single-format-standard">

<div id="main-menu" class="navbar-nav nav"><ul>
<li class="page_item page-item-8"><a href="https://samnicholls.net/about/">About Me</a></li>
<li class="page_item page-item-11"><a href="https://samnicholls.net/talks/">Talks</a></li>
<li class="page_item page-item-15"><a href="https://samnicholls.net/things-i-have-learned/">Things I Have Learned</a></li>
</ul></div></body></html>
        </div>

        </div>
    </nav>
</header>

<div class="container">

    <div class="row"><!-- Content -->
<section class="col-md-8 content-container">
                          <article class="card post hentry post-226 type-post status-publish format-standard category-au-phd tag-blast tag-rapsearch tag-uniprot" id="post-226">
                <header class="entry-header">
                        <h1 class="entry-title">Raiding `rapsearch` Results</h1>                </header><!-- .entry-header -->

                <div class="meta-well">
                    <span style="margin-right:15px;" class=""><span class="fa fa-user"></span>&nbsp;&nbsp;&nbsp;<span class="author vcard"><a class="url fn n" href="https://samnicholls.net/about/">Sam Nicholls</a></span></span>

                    <span style="margin-right:15px;" class="entry-date published updated post-date"><span class="fa fa-clock-o"></span>&nbsp;&nbsp; <time class="entry-date published" datetime="2015-05-09T12:00:56+01:00">9th May 2015</time><time class="updated" datetime="2016-01-18T12:30:18+00:00">18th January 2016</time></span>                    <span style="margin-right:15px;" class=""><span class="fa fa-comments-o"></span>&nbsp;&nbsp; <a href="https://samnicholls.net/2015/05/09/raiding-rapsearch-results/#respond"><span class="dsq-postid" data-dsqidentifier="226 http://blog.ironowl.io/?p=226">No Comments yet</span></a></span>
                    <span class=""><span class="fa fa-folder-open"></span>&nbsp;&nbsp;&nbsp;<a href="https://samnicholls.net/category/bioinf/au-phd/" rel="category tag">AU-PhD</a></span>
                </div>

                <div class="entry-content"><p>Finally. After all the trouble I&#8217;ve had <a href="/2015/04/27/what-am-i-doing/">trying to scale <code>BLAST</code></a>, running <a href="/2015/04/25/scratch/">out of disk space</a>, <a href="/2015/04/24/trembling/">database accounting irregularities</a> and <a href="/2015/05/04/aligned-annihilation-sequel/">investigating an <code>archive_exception</code></a>, <strong>we have data</strong>.</p>
<p>Thanks to the incredible speed of <code>rapsearch</code>, what I&#8217;ve been trying to accomplish over the past few months with <code>BLAST</code> has been done in mere hours without the hassle of database or contig sharding. Quantifying the accuracy of <code>rapsearch</code> is still something our team is working on, but Tom&#8217;s initial results suggest comparable performance to <code>BLAST</code>. For the time being at least, it means I can get things done.</p>
<p>As <a href="/2015/05/01/aligned-annihilation/">previously described</a>, I extracted bacterial, archaeal and fungal associated hydrolases from both the SwissProt (manually curated) and TrEMBL (automatically annotated) databases. The tables below summarise the number of &#8220;raw&#8221; hits from <code>rapsearch</code>, the number of hits remaining after discarding hits with a bitscore of less than 40<sup id="fnref-226-1"><a href="#fn-226-1" rel="footnote">1</a></sup>, followed by the hits remaining after selecting for the &#8220;best&#8221; hit for cases where hits overlap by 100bp<sup id="fnref-226-2"><a href="#fn-226-2" rel="footnote">2</a></sup> or more.</p>
<h2>SwissProt</h2>
<table>
<thead>
<tr>
<th>Taxa</th>
<th>Raw SP</th>
<th>Bitscore Filter</th>
<th>Overlap Filter</th>
</tr>
</thead>
<tbody>
<tr>
<td>Bacteria [2]</td>
<td>127,403</td>
<td>58,715</td>
<td>1,649</td>
</tr>
<tr>
<td>Archaea [2157]</td>
<td>17,141</td>
<td>2,326</td>
<td>341</td>
</tr>
<tr>
<td>Fungi [4751]</td>
<td>78,083</td>
<td>34,180</td>
<td>3,222</td>
</tr>
<tr>
<td><strong>Total</strong></td>
<td>222,627</td>
<td>95,221 (42.77%)</td>
<td>5,212 (5.47%, <em>Raw</em>:2.34%)</td>
</tr>
</tbody>
</table>
<h2>TrEMBL</h2>
<table>
<thead>
<tr>
<th>Taxa</th>
<th>Raw TR</th>
<th>Bitscore Filter</th>
<th>Overlap Filter</th>
</tr>
</thead>
<tbody>
<tr>
<td>Bacteria [2]</td>
<td>683,307</td>
<td>392,791</td>
<td>6,810</td>
</tr>
<tr>
<td>Archaea [2157]</td>
<td>79,738</td>
<td>34,950</td>
<td>1,486</td>
</tr>
<tr>
<td>Fungi [4751]</td>
<td>345,160</td>
<td>190,936</td>
<td>7,379</td>
</tr>
<tr>
<td><strong>Total</strong></td>
<td>1,108,205</td>
<td>618,677 (55.83%)</td>
<td>15,675 (2.53%, <em>Raw</em>:1.41%)</td>
</tr>
</tbody>
</table>
<h2>Merged</h2>
<table>
<thead>
<tr>
<th>Taxa</th>
<th>Raw All</th>
<th>Bitscore Filter</th>
<th>Overlap Filter</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>All</strong></td>
<td>1,330,832</td>
<td>713,898 (53.64%)</td>
<td>12,194 (1.71%, <em>Raw</em>:0.92%)</td>
</tr>
</tbody>
</table>
<p>Initially, I had merged all the hits from both databases and all three taxa together to create a super-hit list; yielding just over 12k reasonable quality (<code>&gt;=40</code>) hits to play with after both filtering steps. However, I became concerned with what I coin <strong>overlap loss</strong>: a significant number of hits were discarded in overlapping regions. 94.53% and 97.47% of our bitscore filtered hits were lost by overlap for SwissProt and TrEMBL lines respectively!</p>
<p>I suspect due to the condensed nature of the assembly (around 16.7 billion base pairs from the raw reads aligning to an assembly consisting of just 433 million base pairs, an average coverage of ~38x) there is likely to be a lot of overlap occurring in 100bp windows. The question is, how well does the top-ranking hit represent a hydrolase? How is &#8220;top-ranking&#8221; defined? Let&#8217;s read the manual<sup id="fnref-226-3"><a href="#fn-226-3" rel="footnote">3</a></sup>:</p>
<blockquote><p>
[&#8230;] preference is given to the db quality first, than the bit score and finally the lenght of annotation, the one with the highest values is kept</p>
<footer>
— <a href="http://pythonhosted.org/mgkit/scripts/filter-gff.html#overlap-filtering">MGKit filter-gff: Overlap Filtering</a><br />
</footer>
</blockquote>
<p>Hmm, it sounds as though database quality is considered paramount by the default ranking device, ensuring that SwissProt results take precedence over those from TrEMBL. However what if the SwissProt hit actually has a lower bitscore? What happens? To check, I&#8217;ll modify <a href="https://bitbucket.org/setsuna80/mgkit/src/f3b5aa7e65d1cc8870743a9c7492ccb2528b8417/mgkit/filter/gff.py?#cl-45">the source</a><sup id="fnref-226-4"><a href="#fn-226-4" rel="footnote">4</a></sup> slightly to construct a trivial example below<sup id="fnref-226-5"><a href="#fn-226-5" rel="footnote">5</a></sup>.</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-64f105f2cf3f2480067901" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# Default discarding function:
# lambda a1, a2: min(a1, a2, key=lambda el: (el.dbq, el.bitscore, len(el)))

# I'll treat a 3-element list as the `el` object, with format:
#    hit = [dbq, bitscore, length]
# Let's re-define the default discarding function to anticipate this list:
discard = lambda a1, a2: min(a1, a2, key=lambda el: (el[0], el[1], el[2]))

# Construct some hits
crap_sp_hit = [10, 39, 100]
good_tr_hit = [8, 60, 100]

# Determine which hit to discard
discard(crap_sp_hit, good_tr_hit)
&gt; [8, 60, 100]
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-64f105f2cf3f2480067901-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-64f105f2cf3f2480067901-2">2</div><div class="crayon-num" data-line="crayon-64f105f2cf3f2480067901-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-64f105f2cf3f2480067901-4">4</div><div class="crayon-num" data-line="crayon-64f105f2cf3f2480067901-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-64f105f2cf3f2480067901-6">6</div><div class="crayon-num" data-line="crayon-64f105f2cf3f2480067901-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-64f105f2cf3f2480067901-8">8</div><div class="crayon-num" data-line="crayon-64f105f2cf3f2480067901-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-64f105f2cf3f2480067901-10">10</div><div class="crayon-num" data-line="crayon-64f105f2cf3f2480067901-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-64f105f2cf3f2480067901-12">12</div><div class="crayon-num" data-line="crayon-64f105f2cf3f2480067901-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-64f105f2cf3f2480067901-14">14</div><div class="crayon-num" data-line="crayon-64f105f2cf3f2480067901-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-64f105f2cf3f2480067901-16">16</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-64f105f2cf3f2480067901-1"><span class="crayon-p"># Default discarding function:</span></div><div class="crayon-line crayon-striped-line" id="crayon-64f105f2cf3f2480067901-2"><span class="crayon-p"># lambda a1, a2: min(a1, a2, key=lambda el: (el.dbq, el.bitscore, len(el)))</span></div><div class="crayon-line" id="crayon-64f105f2cf3f2480067901-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-64f105f2cf3f2480067901-4"><span class="crayon-p"># I'll treat a 3-element list as the `el` object, with format:</span></div><div class="crayon-line" id="crayon-64f105f2cf3f2480067901-5"><span class="crayon-p">#&nbsp;&nbsp;&nbsp;&nbsp;hit = [dbq, bitscore, length]</span></div><div class="crayon-line crayon-striped-line" id="crayon-64f105f2cf3f2480067901-6"><span class="crayon-p"># Let's re-define the default discarding function to anticipate this list:</span></div><div class="crayon-line" id="crayon-64f105f2cf3f2480067901-7"><span class="crayon-v">discard</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">lambda </span><span class="crayon-v">a1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">a2</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">min</span><span class="crayon-sy">(</span><span class="crayon-v">a1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">a2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-o">=</span><span class="crayon-e">lambda </span><span class="crayon-v">el</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">el</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">el</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">el</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-64f105f2cf3f2480067901-8">&nbsp;</div><div class="crayon-line" id="crayon-64f105f2cf3f2480067901-9"><span class="crayon-p"># Construct some hits</span></div><div class="crayon-line crayon-striped-line" id="crayon-64f105f2cf3f2480067901-10"><span class="crayon-v">crap_sp_hit</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">39</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-64f105f2cf3f2480067901-11"><span class="crayon-v">good_tr_hit</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">8</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">60</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-64f105f2cf3f2480067901-12">&nbsp;</div><div class="crayon-line" id="crayon-64f105f2cf3f2480067901-13"><span class="crayon-p"># Determine which hit to discard</span></div><div class="crayon-line crayon-striped-line" id="crayon-64f105f2cf3f2480067901-14"><span class="crayon-e">discard</span><span class="crayon-sy">(</span><span class="crayon-v">crap_sp_hit</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">good_tr_hit</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-64f105f2cf3f2480067901-15"><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">8</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">60</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-64f105f2cf3f2480067901-16">&nbsp;</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p></p>
<p>Welp, the &#8220;better&#8221; TrEMBL originating annotation is discarded. It seems the default selection function ensures database quality above all else. Ideally we&#8217;d like a metric that gives weight to sequences held in SwissProt (to reflect their curation accuracy) but not so much that they are always chosen over better hits from a &#8220;weaker&#8221; database. <code>filter-gff</code> does accept an optional <code>--choose-func</code> parameter which I will now be investigating the behaviour of.</p>
<p>As an aside, it&#8217;s interesting to note the very high number of hits for fungal-associated hydrolases, especially after overlap filtering &#8212; where for both SwissProt and TrEMBL, it has more results than the bacteria and archaea. I wonder whether this is indicative of the host contamination known to be in the data set, as I guess host associated sequences are more likely to have hits in the fungal database as they are both at least eukaryotic.</p>
<p>Before moving on, I&#8217;ll re-run the overlap filtering step with a less naive filtering function and report back. I&#8217;m curious to see what other <strong>overlap loss</strong> is being incurred, are the overlapping hits similar in function and taxonomy, or widely different?</p>
<p>To really consider whether or not the hits are representative of a hydrolase, we need to calculate how much the hit covers the whole database target sequence. It&#8217;s all well and good if we have a high bitscoring hit to a hydrolase, but if it only covers a fraction of the whole sequence, that doesn&#8217;t necessarily bode well for a &#8220;real&#8221; hydrolase being on the contig. Unfortunately, the <code>m8</code>/<code>blast6</code> output formats (such as that of <code>rapsearch</code>) do not give the length of the target sequences, electing to only give the length of the hit region and its identity.</p>
<p>So the next step will be to index the <code>FASTA</code> files used to build the hydrolase databases, then for each hit found by <code>rapsearch</code>: query the <code>FASTA</code> indices for the length of the target hydrolase and work out the proportion of the target covered by the hit. I can then add these values to the <code>GFF</code> files (containing the hits) and refer to them in my own hit discarding function when re-calling <code>filter-gff</code>. Easy.</p>
<p>I&#8217;m somewhat confused though, the proportion of a database sequence covered by a hit seems like a common question to determine how &#8220;good&#8221; a hit really is? I spoke to Tom and he normally defines a good hit by its bitscore and by the number of bases on the hit that actually matched the target sequence exactly (<code>hit length * hit identity</code>), he tells me this is pretty common too.</p>
<p>I guess we want to ensure we&#8217;re discovering &#8220;real&#8221; hydrolases by picking out annotations that cover as much of a known hydrolase gene as possible. But it still seems strange to me that this sort of metric isn&#8217;t more commonly used, are we doing something special?</p>
<hr />
<h1>tl;dr</h1>
<ul>
<li>We have data. Already it raises more questions than answers.</li>
<li>MGKit&#8217;s <code>filter-gff</code> annotation overlap discarder has a superiority complex causing it to liberally discard annotations from a &#8220;weaker&#8221; database by default.</li>
<li>You never quite get what you need from a program&#8217;s output.</li>
</ul>
<div class="footnotes">
<hr />
<ol>
<li id="fn-226-1">
This seems to be a fairly commonly used &#8220;cut-off&#8221; threshold when looking at hit quality.&#160;<a href="#fnref-226-1" rev="footnote">&#8617;</a>
</li>
<li id="fn-226-2">
Using <a href="http://pythonhosted.org/mgkit/scripts/filter-gff.html#overlap-filtering">filter-gff</a>.&#160;<a href="#fnref-226-2" rev="footnote">&#8617;</a>
</li>
<li id="fn-226-3">
This is a good reflex reaction.&#160;<a href="#fnref-226-3" rev="footnote">&#8617;</a>
</li>
<li id="fn-226-4">
I did panic briefly when I saw the function minimises rather than maximises quality; only to read the documentation further and discover the function must return the annotation to be discarded, rather than selected. Phew.&#160;<a href="#fnref-226-4" rev="footnote">&#8617;</a>
</li>
<li id="fn-226-5">
Our team uses a database quality score of <code>8</code> for <strong>TrEMBL</strong> and <code>10</code> for <strong>Swissprot</strong> annotations. Though the numbers don&#8217;t particularly matter, just so long as <code>SP &gt; TR</code>.&#160;<a href="#fnref-226-5" rev="footnote">&#8617;</a>
</li>
</ol>
</div>
</div>
                
                        <div class="tag-well"><span><span class="fa fa-tags"></span>&nbsp;&nbsp; <a href="https://samnicholls.net/tag/blast/" rel="tag">blast</a>,&nbsp; <a href="https://samnicholls.net/tag/rapsearch/" rel="tag">rapsearch</a>,&nbsp; <a href="https://samnicholls.net/tag/uniprot/" rel="tag">uniprot</a></span></div>
                
                <nav class="further-reading">
	<div class="previous">
		<span>Previous Post</span>
		<a href="https://samnicholls.net/2015/05/04/aligned-annihilation-sequel/">Aligned Annihilation II: Dumpster Diving</a>
	</div>
	<div class="next">
		<span>Next Post</span>
		<a href="https://samnicholls.net/2015/05/15/microscopy/">Microscopy</a>
	</div>
</nav>            </article>
                                <div class="card">

<div id="disqus_thread"></div>
                </div>
    
</section>

        <!-- Sidebar -->
        <aside class="col-md-4 sidebar-container">
		            <div id="widget-area" class="widget-area" role="complementary">
                <div id="custom_html-3" class="widget_text card widget widget_custom_html"><div class="textwidget custom-html-widget"><img src="https://pbs.twimg.com/profile_images/1044255545610436609/wt33ZbtU_400x400.jpg" height=120 style="margin-top: 20px; margin-right:10px; float: left;" alt="Sam Nicholls" />
<div style="padding-top:15px; line-height: normal"><b style="font-size: 1.2em">Sam Nicholls</b><br><span style="font-size: 0.9em;">Haplotype Wrangler at University of Birmingham.<br>I tell computers to do things, then I write about how it all went wrong.</span></div></div></div><div id="search-2" class="card widget widget_search"><form style="margin-top:15px" action="https://samnicholls.net/" id="searchform" method="get" role="form">
    <div class="form-group">
        <input type="text" class="form-control" name="s" id="s" placeholder="e.g. Search...">
    </div>
</form>
</div><div id="twitter_timeline-5" class="card widget widget_twitter_timeline"><a class="twitter-timeline" data-height="400" data-theme="light" data-link-color="#f96e5b" data-border-color="#e8e8e8" data-lang="EN" data-partner="jetpack" data-chrome="noheader nofooter noborders" href="https://twitter.com/samstudio8">My Tweets</a></div><div id="categories-5" class="card widget widget_categories"><h2>Categories</h2>
			<ul>
					<li class="cat-item cat-item-2"><a href="https://samnicholls.net/category/bioinf/">Bioinformatics</a>
<ul class='children'>
	<li class="cat-item cat-item-8"><a href="https://samnicholls.net/category/bioinf/au-phd/">AU-PhD</a>
</li>
	<li class="cat-item cat-item-3"><a href="https://samnicholls.net/category/bioinf/sanger-qc/" title="Sanger QC Project">Sanger-QC</a>
</li>
	<li class="cat-item cat-item-61"><a href="https://samnicholls.net/category/bioinf/tools/">Tools</a>
	<ul class='children'>
	<li class="cat-item cat-item-185"><a href="https://samnicholls.net/category/bioinf/tools/chitin/">chitin</a>
</li>
	</ul>
</li>
</ul>
</li>
	<li class="cat-item cat-item-80"><a href="https://samnicholls.net/category/devops/">Devops</a>
</li>
	<li class="cat-item cat-item-114"><a href="https://samnicholls.net/category/event/">Event</a>
</li>
	<li class="cat-item cat-item-21"><a href="https://samnicholls.net/category/gadgets/">Gadgets</a>
</li>
	<li class="cat-item cat-item-176"><a href="https://samnicholls.net/category/hardware/">Hardware</a>
<ul class='children'>
	<li class="cat-item cat-item-223"><a href="https://samnicholls.net/category/hardware/beehive-monitor/">Beehive Monitor</a>
</li>
	<li class="cat-item cat-item-178"><a href="https://samnicholls.net/category/hardware/esp8266/">ESP8266</a>
</li>
	<li class="cat-item cat-item-236"><a href="https://samnicholls.net/category/hardware/lego-sequencer/">Lego Sequencer</a>
</li>
	<li class="cat-item cat-item-177"><a href="https://samnicholls.net/category/hardware/lightstick/">Lightstick</a>
</li>
</ul>
</li>
	<li class="cat-item cat-item-151"><a href="https://samnicholls.net/category/lab/">Lab</a>
<ul class='children'>
	<li class="cat-item cat-item-150"><a href="https://samnicholls.net/category/lab/protocol-guides/">Protocol Guides</a>
</li>
</ul>
</li>
	<li class="cat-item cat-item-5"><a href="https://samnicholls.net/category/meta/">Meta</a>
</li>
	<li class="cat-item cat-item-62"><a href="https://samnicholls.net/category/mysteries/">Mysteries</a>
</li>
	<li class="cat-item cat-item-22"><a href="https://samnicholls.net/category/personal/">Personal</a>
</li>
	<li class="cat-item cat-item-4"><a href="https://samnicholls.net/category/photo/">Photography</a>
</li>
	<li class="cat-item cat-item-143"><a href="https://samnicholls.net/category/programming/">Programming</a>
<ul class='children'>
	<li class="cat-item cat-item-145"><a href="https://samnicholls.net/category/programming/documentation/">Documentation</a>
</li>
	<li class="cat-item cat-item-144"><a href="https://samnicholls.net/category/programming/python/">Python</a>
</li>
</ul>
</li>
	<li class="cat-item cat-item-48"><a href="https://samnicholls.net/category/status-report/">Status Report</a>
</li>
	<li class="cat-item cat-item-60"><a href="https://samnicholls.net/category/sysadm/">System Administration</a>
</li>
	<li class="cat-item cat-item-1"><a href="https://samnicholls.net/category/uncategorised/">Uncategorised</a>
</li>
			</ul>

			</div>            </div>
		        </aside>
    </div>

</div> <!-- /container -->

<footer id="main-footer" class="bg-primary">
	<div id="footer-widgets" class="container">
		    </div>
</footer>



	<div style="display:none">
	</div>
<script type='text/javascript' src='https://samnicholls.net/wp-includes/js/comment-reply.min.js?ver=5.7.5' id='comment-reply-js'></script>
<script type='text/javascript' id='disqus_count-js-extra'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"samposium-blog"};
/* ]]> */
</script>
<script type='text/javascript' src='https://samnicholls.net/wp-content/plugins/disqus-comment-system/public/js/comment_count.js?ver=3.0.17' id='disqus_count-js'></script>
<script type='text/javascript' id='disqus_embed-js-extra'>
/* <![CDATA[ */
var embedVars = {"disqusConfig":{"integration":"wordpress 3.0.17"},"disqusIdentifier":"226 http:\/\/blog.ironowl.io\/?p=226","disqusShortname":"samposium-blog","disqusTitle":"Raiding `rapsearch` Results","disqusUrl":"https:\/\/samnicholls.net\/2015\/05\/09\/raiding-rapsearch-results\/","postId":"226"};
/* ]]> */
</script>
<script type='text/javascript' src='https://samnicholls.net/wp-content/plugins/disqus-comment-system/public/js/comment_embed.js?ver=3.0.17' id='disqus_embed-js'></script>
<script type='text/javascript' src='https://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=202335' id='devicepx-js'></script>
<script type='text/javascript' src='https://samnicholls.net/wp-content/plugins/jetpack/_inc/twitter-timeline.js?ver=4.0.0' id='jetpack-twitter-timeline-js'></script>
<script type='text/javascript' src='https://samnicholls.net/wp-includes/js/wp-embed.min.js?ver=5.7.5' id='wp-embed-js'></script>
<script type='text/javascript' src='https://stats.wp.com/e-202335.js' async defer></script>
<script type='text/javascript'>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:4.9',blog:'101350222',post:'226',tz:'1',srv:'samnicholls.net'} ]);
	_stq.push([ 'clickTrackerInit', '101350222', '226' ]);
</script>

<script type="text/javascript">
(function() {
  if (navigator.userAgent.match(/IEMobile\/10\.0/)) {
    var msViewportStyle = document.createElement("style");
    msViewportStyle.appendChild(
      document.createTextNode("@-ms-viewport{width:auto!important}")
    );
    document.getElementsByTagName("head")[0].appendChild(msViewportStyle);
  }
})();

var collapsed = false;
jQuery( document ).ready(function($) {
    $('.navbar-toggle').click(function(){
        console.log(collapsed);
        if(collapsed) {
            $('.navbar-header > button').html('<i class="fa fa-bars"></i>');
        } else {
            $('.navbar-header > button').html('<i class="fa fa-times"></i>');
        }
        $('.navbar-collapse').toggle(200);
        collapsed = !collapsed;
    });
});
</script>
	
</body>

</html>
